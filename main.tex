\documentclass{beamer}
%\usetheme{kth}

\usepackage[utf8]{inputenc}
\usepackage[european]{circuitikz}
\usepackage{tikz}
 \usetikzlibrary{shapes, calc, intersections, positioning, external}
 \tikzexternalize[prefix=img/extern/]
\usepackage{pgfplots}
 \pgfplotsset{compat=1.15}
 \usepgfplotslibrary{groupplots,fillbetween}
\usepackage{tikz-timing}
\usepackage{siunitx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{subcaption}
\usepackage{booktabs}
\usepackage{multicol}
\usepackage{minted}

\newcommand*{\subb}[1]{\ensuremath{_{\mathrm{#1}}}}
\newcommand*{\supp}[1]{\ensuremath{^{\mathrm{#1}}}}
\renewcommand*{\j}{\ensuremath{{\mathrm{j}}}}

\addtobeamertemplate{navigation symbols}{}{%
 \usebeamerfont{footline}%
 \usebeamercolor[fg]{footline}%
 \hspace{1em}%
 \raisebox{1.2pt}[0pt][0pt]{\insertframenumber/\inserttotalframenumber}
}

\title{IL2239 - Course Project}
\subtitle{Design of a SAR ADC}
\author{J.~Altayó \and B.~Sunedahl}
\date{March of 2019}

\begin{document}
 \section*{}
 \begin{frame}[plain, t]
  \titlepage
 \end{frame}
 
 \begin{frame}{Outline}
  \begin{multicols}{2}
   \tableofcontents
  \end{multicols}
 \end{frame}
 \section{Project Description}
 \begin{frame}{Project Description}
  Design of a single-ended SAR ADC with the following specifications.
  \begin{itemize}
   \item Comparator clock frequency: \SI{100}{\MHz}
   \item SNDR \textgreater\ 28 dB and SFDR \textgreater\ 37 dB
   \item Technology: 150 nm CMOS
   \item Supply voltage: 1.8 V
   \item Input amplitude ($V\subb{in}$): \SI{0.5}{\volt_{pp}}
   \item Input common-mode voltage: $0 \leq V\subb{in,cm} \leq 1.8$ V
   \item Voltage reference: $V\subb{ref} \leq 1.8$ V
   \item Switching enegy below 30 pJ for $V\subb{in}=300$ mV
  \end{itemize}
 \end{frame}
 
 \section{Roles and Responsibilities}
 \begin{frame}{Roles and Responsibilities}
  \begin{columns}
   \begin{column}{0.5\textwidth}
    Jordi:
    \begin{itemize}
     \item Comparator
     \item Successive Approximation Register
     \item Comparator Layout
    \end{itemize}
   \end{column}
   \begin{column}{0.5\textwidth}
    Björn:
    \begin{itemize}
     \item Digital-to-Analog Converter
     \item Sample \& Hold
     \item DAC Layout
    \end{itemize}
   \end{column}
  \end{columns}
 \end{frame}
 \section{Design Flow}
 \begin{frame}{Design Flow}
  We used a top-down design approach:
  \vspace{2em}
  \begin{enumerate}
   \item System-level design
   \item Behavioral modeling using Verilog-AMS
   \item Transistor level modeling
   \item Layout
  \end{enumerate}
  \vspace{2em}
  \visible<2->{Co-simulations where also used to test individual blocks functionality}
%  \begin{center}
%   \resizebox{\textwidth}{!}{\input{tikz/V.tex}}
%  \end{center}
 \end{frame}
 
 \AtBeginSection[]{
  \begin{frame}{Outline}
   \begin{multicols}{2}
    \tableofcontents[
     sectionstyle=show/shaded,
     subsectionstyle=show/show/shaded,
     subsubsectionstyle=show/show/show/shaded
    ]
   \end{multicols}
  \end{frame}
 }

 \section{System-level Design}
 \subsection{Problem Statement}
 \begin{frame}
  {System-level Design I}{Problem Statement}
  The basic block diagram of a SAR ADC looks as follows

  \vspace*{2em}
  \tikzsetnextfilename{sar}
  \resizebox{\textwidth}{!}{\input{tikz/sar}}
 \end{frame}
 \subsection{Proposed Solution}
 \begin{frame}
  {System-level Design II}{Proposed Solution}
  The following topology was used:
  \vspace{1em}
  \begin{itemize}
   \item Comparator: \alert{Strong ARM Latch}
    \begin{itemize}
     \item[--] Reduced power consumption 
     \item[--] Fast operation
     \item[--] Small area
    \end{itemize}
   \item<2-> DAC: \alert{Charge redistribution weighted capacitors}
    \begin{itemize}
     \item[--] Suitable for CMOS technology
     \item[--] Integrates the Sample \& Hold
    \end{itemize}
   \item<3-> SAR: \alert{Successive Approximation Register}
    \begin{itemize}
     \item[--] Integrates controls for Sample \& Hold
     \item[--] Implemented as 7 state FSM
     \item[--] Verilog model
    \end{itemize}
  \end{itemize}
 \end{frame}
 \subsection{Behavioral Modeling}
 \subsubsection{Comparator}
 \begin{frame}[fragile]{System-level Design III}{Behavioral Modeling I}
  Comparator modeling:
  \begin{minted}%{verilog}
   [
    frame=lines,
    framesep=2mm,
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos
   ]{verilog}
always @(posedge CLK) begin
    #5
    outn = 0; outp = 0;
end
always @(negedge CLK) begin
  if(V(inp) > V(inn)) begin
    #50
    outp = 1; outn = 0;
  end else begin
    #50
    outp = 0; outn = 1;
  end
end
  \end{minted}
  Some delay was added to the behavioral model.
 \end{frame}

 \subsubsection{Digital-to-Analog Converter}
 \begin{frame}[fragile]{System-level Design III}{Behavioral Modeling II}
  Digital-to-Analog Converter modeling:
  \begin{minted}%{verilog}
   [
    frame=lines,
    framesep=2mm,
    baselinestretch=1.2,
    fontsize=\footnotesize,
    linenos
   ]{verilog}
analog begin
  always @(posedge CLK) begin
    for(i=0, i < 5, i++) begin
      result += input[5-i] * Vref/5;
    end
    V(out) <+ transition(result, 1ns, 0.1ns, 0.1ns)
  end
end
  \end{minted}
 \end{frame}
 \subsubsection{Successive Approximation Register}
 \begin{frame}{System-level Design III}{Behavioral Modeling III}
  SAR algorithm: binary search\hspace*{1em}
  \begin{columns}
   \begin{column}{0.5\textwidth}
    \tikzexternaldisable
    \tikzsetnextfilename{sar_algorithm}
    \resizebox{!}{0.7\textheight}{\input{tikz/sar_algorith}}
   \end{column}
   \begin{column}{0.5\textwidth}
    Assume $V\subb{in}=\SI{0.7}{\V}$, $V\subb{ref}=\SI{1}{\V}$ and 4 bits\vspace{1em}
    \begin{enumerate}
     \item<2-> $V\subb{in} \overset{?}{\ge} \frac{V\subb{ref}}{2}$ {\color{green}\checkmark}
     \item<3-> $V\subb{in} \overset{?}{\ge} \frac{3V\subb{ref}}{4}$ {\color{red}\text{\sffamily X}}
     \item<4-> $V\subb{in} \overset{?}{\ge} \frac{5V\subb{ref}}{8}$ {\color{green}\checkmark}
     \item<5-> $V\subb{in} \overset{?}{\ge} \frac{11V\subb{ref}}{16}$ {\color{green}\checkmark}
    \end{enumerate}
    \vspace{2em}
    \visible<6->{Out = 0b1011 ($\frac{11V\subb{ref}}{16}$)}

   \end{column}
  \end{columns}
 \end{frame}
 \section{Transistor-level Design}
 \subsection{Comparator}
 \begin{frame}{Transistor-level Design I}{Comparator}
  Strong ARM Latch topology

  \includegraphics[width=\textwidth]{img/comp_sch}
 \end{frame}
 \subsection{Digital-to-Analog Converter}
 \begin{frame}{Transistor-level Design II}{Digital-to-Analog Converter}
  \centering
  \makebox[\textwidth][c]{\includegraphics[width=1.3\textwidth]{img/dac_sch}}
 \end{frame}
%\addtocontents{toc}{\newpage}
 \section{Layout}
 \subsection{Comparator}
 \begin{frame}{Layout I}{Comparator}
  \includegraphics[width=\textwidth]{img/comparator_layout}

  \begin{columns}
   \begin{column}{0.5\textwidth}
    \begin{itemize}
     \item Common centroid for the differential input pair
    \end{itemize}
   \end{column}
   \begin{column}{0.5\textwidth}
    \begin{itemize}
     \item<2-> Guard ring around sensitive high impedance nodes
    \end{itemize}
   \end{column}
  \end{columns}
 \end{frame}
 
 \subsection{Digital-to-Analog Converter}
 \begin{frame}{Layout II}{Digital-to-Analog Converter I}
    \begin{columns}
    \begin{column}{0.40\linewidth}
    To ensure good matching we used: 
    \begin{itemize}
        \item Common centroid technique
        \item<2-> Base unit of half the minmum capacitance
        \item<3-> Dummy capacitors at the edges
    \end{itemize}
    \vspace{3em}
    \end{column}
    \begin{column}{0.60\linewidth}
        \centering
        \tikzsetnextfilename{cap_matrix}
        \input{tikz/cap_matrix.tex}
    \end{column}
    \end{columns}
 \end{frame}
 
 \begin{frame}{Layout II}{Digital-to-Analog Converter II}
     \centering
     \includegraphics[height=.8\textheight]{img/cap_layout}
 \end{frame}
 
 \section{Simulations}
 \subsection{Sinusoidal Stimulus}
 \begin{frame}{Simulations I}{Sinusoidal Stimulus}
  \centering
  \tikzsetnextfilename{sinusoidal_conversion}
  \resizebox{!}{0.8\textheight}{\input{tikz/sinusoidal-conversion}}
 \end{frame}

 \subsection{Ramp Stimulus}
 \begin{frame}{Simulations II}{Ramp Stimulus}
  \centering
  \tikzsetnextfilename{ramp_conversion}
  \resizebox{!}{0.8\textheight}{\input{tikz/ramp-conversion}}
 \end{frame}

 \subsection{Spectrum}
 \begin{frame}{Simulations III}{Spectrum}
  \centering
  \includegraphics[width=\textwidth]{img/fft}
  Input frequency: \SI{1.3}{\MHz}
 \end{frame}
 \AtBeginSection[]{}
 
 \section{Figures of Merit}
 \begin{frame}{Figures of Merit}
  \centering
  \begin{tabular}[]{cc}
   \toprule
   Sample rate & \SI{14.29}{\MHz}\\
   ENOB & \num{4.78}\\
   SNDR & \SI{30.55}{dB}\\
   SFDR & \SI{38.16}{dB}\\
   THD & \SI{1.44}{\percent}\\
   INL & \alert{\SI{10.22}{\mV}}\\
   DNL & \alert{\SI{8.32}{\mV}}\\
   Energy per cycle & \SI{4.31}{\pico\joule}\\\bottomrule
  \end{tabular}
 \end{frame}
 \section{Conclusions}
 \begin{frame}{Conclusions}
  We were able to
  \begin{itemize}
   \item Work on a state-of-the-art ADC topology
   \item<2-> Learn behavioral modeling techniques
   \item<3-> Hands-on experience with charge redistribution circuits
  \end{itemize}
 \end{frame}

 \section{References}
 \begin{frame}{References}
  \nocite{*}
  \bibliographystyle{amsalpha}
  \bibliography{references}
 \end{frame}
\end{document} 
